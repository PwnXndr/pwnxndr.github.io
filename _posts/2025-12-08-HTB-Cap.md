---
layout: post
title:  "Cap - HackTheBox"
date:   2025-08-12
categories: [HTB]
tags: [HackTheBox, IDOR,Python,capabilities, directory-traversal]
image: "../assets/machines/HTB_Cap/logo.png"
---
Cap es una máquina Linux de dificultad fácil que ejecuta un servidor HTTP con funciones administrativas, como la captura de tráfico de red. Analizando estas funciones, es posible obtener información sensible que permite avanzar en la intrusión.

![](/assets/machines/HTB_Cap/info.png)

# Enumeracion:
Usaremos `nmap`, para buscar los **puertos y servicios** que estan corriendo detras del servicio.

![](/assets/machines/HTB_Cap/1.png)

Descubriremos 3 puertos abiertos:

- `21` del FTP.

- `22` del SSH.

- `80` de un servicio web HTTP.

Si entramos en el servicio `WEB`, veremos que es un dashboard que lo interesante es que permite "*hacer*" capturas de red.

![](/assets/machines/HTB_Cap/2.png)

Si vemos el menu, existe un apartado cuyo nombre es <span class="color-text-lime">*Security Snapshot*</span>.
Si vamos a ese apartado, podremos ver en la `URL` que se referencia a cierto objeto o captura, tambien podremos apreciar un <span class="color-text-orange">**BOTON**</span>

![](/assets/machines/HTB_Cap/3.png)

## IDOR

Por lo que se nos puede ocurrir ejecutar un <span class="color-text-red">**IDOR**</span>. Generalmente usariamos **Web-Fuzzing**, si analizamos el HTML de la WEB, podremos ver que el boton referencia a una ruta que permite descargar las capturas.

![](/assets/machines/HTB_Cap/4.png)

Bueno, una vez hecha, veremos archivos que tienen un peso interesante:

![](/assets/machines/HTB_Cap/5.png)

Si guardamos la captura 0 y la analizamos con `TSHARK`, encontraremos cosas interesantes.

![](/assets/machines/HTB_Cap/6.png)

## USER PASSWORD

Si buscamos entre esas capturas veremos cosas interesantes de un puerto que ya hemos descubierto, <span class="color-text-lime">*FTP*</span>.

<span class="color-text-salmon">Comando para filtro en TSHARK:</span>

`tshark -r <captura>.pcap -Y "<request>"`

![](/assets/machines/HTB_Cap/7.png)

Descubrimos la password del usuario <span class="color-text-blue">**nathan**</span>.

![](/assets/machines/HTB_Cap/8.png)

## PRIVESC
Una vez ingresamos usando el puerto SSH, nos queda <span class="color-text-yellow">**elevar nuestro privilegio**</span>.

Si buscamos permisos en `sudoers`, o con `SUID` <span class="color-text-yellow">**NO encontraremos nada**</span>.

Pero si filtramos por `capabilities`, veremos que **Python** tiene asignada la capabilidad `setuid`.

![](/assets/machines/HTB_Cap/9.png)

Por lo que podemos aprovechar esto para ejecutar comandos como usuario root:

{% highlight python %}
#Python
import os
os.setuid(0)
os.system("bash")
{% endhighlight %}

![](/assets/machines/HTB_Cap/10.png)

# FIN